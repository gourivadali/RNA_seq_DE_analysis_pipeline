# RNA_seq_DE_analysis_pipeline
This pipeline is used to run the RNA-Seq workflow for performing Differential Expression Analysis

**Note** Prior to running the workflow. There are a series of QC steps performed to eventually obtain the readcount matrix of genes and the number of reads they mapped to in every sample.

### RNA Seq QC pipeline used
1. The split replicate fastq files were first merged so that we obtain 2 replicates per state.
2. Before proceeding with running the shell scripts. Place the `truseq_adapter.fasta`, `phix.fasta`, `plasmid.fasta` and the `ecoli_DH10B_ref_genome_NCBI_sequence.fasta` files in a location which can be accessed by the `trim_qc_contaminant_phix_plasmid_seq_filter.sh` file. 
**Make sure that you update the trim_qc_contaminant_phix_plasmid_seq_filter.sh file to reflect the updated locations for all the .fasta files**
3. The merged fastq files underwent quality trimming, FastQC stats generation using the `trim_qc_contaminant_phix_plasmid_seq_filter.sh`. The script can be run by simply typing - 
```
./trim_qc_contaminant_phix_plasmid_seq_filter.sh <dir_name>

where <dir_name> = where all the merged fastq.gz sample files are located
```
* This script generates 3 folders and 1 file `qc_reads`, `phix_qc_reads`, `plasmid_removed_reads` and `multiqc_report.html`
I generated a multiqc report of all the FastQC stats on every .fastq file in 1 report called `multiqc_report.html`. For further downstream processing, we are only interested in files present in `plasmid_removed_reads` folder.
4. TruSeq adapter reads, phix reads (a regular illumina spike-in) and plasmid sequences were removed from the qc-ed fastq by using the bbduk.sh script from the bbMap tools package within the `trim_qc_contaminant_phix_plasmid_seq_filter.sh` file. The script can be used as shown in step #2.
5. Before aligning the qc-ed fastq files present in the `plasmid_removed_reads`, we need to generate a genome index file and store it in a folder, using a splice aware aligner, STAR in our case. To generate a folder where all the indices will be stored, you can simply type in your command prompt - 
```
mkdir -p star-genome
```
the genome index file is then generated by simply typing - 
```
STAR --runMode genomeGenerate --genomeDir star-genome --genomeFastaFiles ecoli_DH10B_ref_genome_NCBI_sequence.fasta --runThreadN 2 --genomeSAindexNbases 10
```
**Make sure that the ecoli reference fasta file location is properly mentioned while creating a genome index file**

5. Once checked for all of the above, the fastq files were then aligned to the ecoli refeence genome downloaded from NCBI-RefSeq using a splice aware aligner, STAR using the `run_starjob.sh`. The script can be run by simply typing - 
```
./run_starjob.sh <qc_dir_name>

where <qc_dir_name> = where all the unzipped .fastq sample files from the `plasmid_removed_reads` folder exist.

``` 
6. Once aligned to the reference genome, `htseq-counts` was used to count the genes mapped to the genome. This is dont by simply typing - 
```
./htseq-counts <aligned_files_dir>

where <aligned_files_dir> contain all the .bam alignments generated in step #4
```

7. The sample specific count files are then merged into a count matrix file to feed through the DESeq2 RNA-Seq analysis pipeline. This can be done by simply typing - 
```
./concat_counts.sh <counts_file_dir>

where <counts_file_dir> = directory containing all the sample specific counts generated in step #5
```
* Steps 1 thru 7 are run on a linux based OS. All the required scripts to run the RNA-Seq QC pipeline can be found in the repository 
* The merged count matrix file generated in Step #5 is further used to run the RNA Seq DE analysis workflow to obtain the differential genes between the two states.

### Running the differential expression analysis workflow
1. This step can be run on a server with latest R server installed. Make sure you have the latest version of R server installed.
2. Once you have confirmed the installation, type `R` in your command prompt (Windows/Linux) which will take you to the R environment.
3. Install all the necessary packages needed to run the R DESeq2 workflow by typing the following - 
```
install.packages(c("tibble","reshape2","RColorBrewer","pheatmap","dplyr","ggplot2","optparse"))
```
**To install DESeq2 you can refer the link - [DESeq2 installation](http://bioconductor.org/packages/release/bioc/html/DESeq2.html)**

4. Once all the packages are installed you are ready to run the workflow! **NOTE: Make sure the merged counts matrix file, the gene_annotation file and the .R script exist in the same folder**

5. Go to your command prompt and type - 
```
Rscript --vanilla Data_Challenge_Asimov.R --help
```
This will run the script and display the help section mentioning what command line argurments you need to give to run the workflow.

6. To run the workflow, simply type - 
```
Rscript --vanilla Data_Challenge_Asimov.R --counts_file <merged_counts.txt> --annot_file <geneIDs_name.txt> --outdir <the folder where all the 3 files exist> (as mentioned in the **NOTE** in step #4).
```

7. when you hit enter, the script runs and generates 1 folder and 2 output files. The folder consists of all the plots generated by the R workflow. The 2 files are the significant gene files with Log2 fold change and p.adjusted value information in 1 file and the normalized counts for the significnat genes in another file.
